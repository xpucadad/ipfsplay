<html>
<body>
<h1>Hello L4R World!</h1>
<h5>V0.9</h5>
<p>This web page is being served from the ipfs p2p network. This is, there
  is no single server on which it is hosted.</p>
<h2>Note:</h2>
<p>It appears that files added to this network disappear after some time. I keep having to re-add and re-publish this page to keep it available.</p>
<p>I have tried to fix this by adding and publishing on a server that is running the daemon. This should work and we shall see.</p>
<h2>Here is the setup:</h2>
<ul>
<li>The page source is in the file website/index.html.</li>
<li>The website folder is added to ipfs, generating a hash $WEBSITE_HASH: "ipfs add -r website". The -r will recurse to all files in the website folder.</li>
<li>The hash is published to the peer id: "ipfs name publish ipfs/$WEBSITE_HASH". (I think it is no longer necessary to supply the "/ipfs" in the path to the $WEBSITE_HASH when publishing. I seem to remember getting an error when I used it.)</li>
<li>A DNS Cname record is created to map ipfstest.looking4.net to gateway.ipfs.io.</li>
<li>A DNS Text record is created which maps the site url prepended with the special ipfs "_dnslink.". That is defining a text record with the host set to "_dnslink.ipfstest.looking4reality.net", and the text set to "dnslink=ipns/$PEER_ID", where $PEER_ID is the local ipfs daemon's peer id.</li>
</ul>
<h2>The page is retrieved as follows:</h2>
<ol>
<li>User provivdes the following URL to a browser: http://ipfstest.looking4reality.net</li>
<li>Browser asks dns for the information for the URL.</li>
<li>DNS uses the Cname to get the target url "gateway.ipfs.io", and returns it and the text record that defines the special _dnslink to the browser.</li>
<li>The browser sends the request to gateway.ipfs.io (from Cname) along with the special _dnslink text record.</li>
<li>The gateway gets the ipns dnslink from the text record and uses this to retrieve the peer id.</li>
<li>The gateway uses the peer id to look up the published hash ($WEBSITE_HASH above) using ipns.</li>
<li>The gateway retrieves the ipfs content using the $WEBSITE_HASH and returns it to the browser.</li>
<li>The browser renders the site.</li>
</ol>
<h2>Updating the site</h2>
<p>To update the site:</p>
<ol>
  <li>The content of the site (in the website folder) is updated.</li>
  <li>A new $WEBSITE_HASH is generated by adding the website to IPFS: "ipfs add -r website".</li>
  <li>The new $WEBSITE_HASH is published to the peer id: "ipfs name publish ipfs/$WEBSITE_HASH". (As mentioned in the Setup section above, I don't think the "ipfs" part is needed any longer.)</li>
  <li>The updated site should now be served for http://ipfstest.looking4reality.net.</li>
</ol>
<p>Note that if you move the daemon to another server, the peer id you got when running the ipfs daemon will be different. Therefore you will need to change the target in the DNS text record's dnslink to use the peer id from the new server.</p>
<hr>
<p>This is version 0.9</p>
</body>
</html>
